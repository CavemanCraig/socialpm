<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:ocp="http://java.sun.com/jsf/composite/ocpcommon"
	xmlns:tmpl="http://java.sun.com/jsf/composite/ocpsoft-jsf2-templates/liquid-blue-2col"
	xmlns:pretty="http://ocpsoft.com/prettyfaces"
	xmlns:spm="http://java.sun.com/jsf/composite/socialpm"
	xmlns:a="http://java.sun.com/jsf/composite/ajax">

<ui:composition template="/WEB-INF/view/templates/socialpm.xhtml">
	<ui:param name="title"
		value="#{currentProjectBean.project.name} &#187; Team Members" />

	<ui:define name="header"><h2>&#171; Team Members</h2></ui:define>
		
	<ui:define name="side-items">
		<h:panelGroup rendered="#{authorizationBean.isAdmin}">
			<li>
				<h3>Invite someone</h3>
				<div>
					<h:form>
						<ocp:formFix />
						<label for="invite">Username: <ocp:message for="invite"/></label><br/>
						<h:inputText id="invite" value="#{manageUsersBean.invitee}">
							<f:validator validatorId="usernameValidator" />
						</h:inputText>
						<h:commandButton value="Invite" action="#{manageUsersBean.inviteByUsername}"/>
					</h:form>
				</div>
			</li>
			
			<h:panelGroup rendered="#{!empty currentProjectBean.project.pendingMembers}">
				<li>
					<h:form>
						<ocp:formFix />
						<h3>Pending members</h3>
						<div>
							<ui:repeat var="u" value="#{currentProjectBean.project.pendingMembers}">
								<div class="box-shaded m5t m5b p5b"> 
									<table width="100%">
										<tr>
											<td align="left">
												<spm:userLink user="#{u}" />
												<h:outputText  value=" - Requested: " rendered="#{currentProjectBean.project.getMembership(u).role == 'REQUESTED'}" /> 
												<h:outputText  value=" - Invited: " rendered="#{currentProjectBean.project.getMembership(u).role == 'INVITED'}" /> 
												<h:outputText styleClass="faded" value="#{currentProjectBean.project.getMembership(u).createdOn}">
													<f:convertDateTime style="SHORT" />
												</h:outputText>
											</td>
											<td align="right" width="25px;">
												<h:commandLink styleClass="m5l" title="Accept member request" action="#{manageUsersBean.makeMember(u)}"
													rendered="#{currentProjectBean.project.getMembership(u).role == 'REQUESTED'}">
													<h:graphicImage height="20" width="20"  url="/images/stock/thumbs_up.gif"
														style="position: relative; top: 4px;" />
												</h:commandLink>
												<h:commandLink styleClass="m5l" title="Remove membership request" action="#{manageUsersBean.removeMember(u)}"
													onclick="return confirm('Really remove #{u.username}?')">
													<h:graphicImage height="20" width="20" url="/images/stock/thumbs_down.gif"
														style="position: relative; top: 4px;"  />
												</h:commandLink>
											</td>
										</tr>
									</table>
								</div>
							</ui:repeat>
							<ocp:separator />
							<div class="fr">
								<h:commandButton value="Accept All" action="#{manageUsersBean.acceptAllMembershipRequests}"
									onclick="return confirm('Really accept all pending membership requests?')" />
								<h:commandButton value="Reject All" action="#{manageUsersBean.removeAllMembershipRequests}"
									onclick="return confirm('Really remove all pending membership requests?')" />
							</div>
							<div class="clearing"></div>
						</div>
					</h:form>
				</li>
			</h:panelGroup>
		</h:panelGroup>
	</ui:define>
	
	<ui:define name="content">
		<h:form id="manageUserForm" prependId="false">
			<ocp:formFix />
			<div class="box-bordered p5 m5b">
				<h4>Owners:</h4>
				<h:outputText value="None" rendered="#{empty manageUsersBean.project.owners}" />
				<ui:repeat var="u" value="#{manageUsersBean.project.owners}">
					<div class="box-shaded m5 p5">
						<div class="fl p5">
							<spm:userLink user="#{u}" />
						</div>
						<div class="fr p5">
							Joined:
							<h:outputText styleClass="faded" value="#{manageUsersBean.project.getMembership(u).createdOn}">
								<f:convertDateTime style="SHORT" /> 
							</h:outputText><h:outputText value=" " />
						</div>
						<div class="clearing"></div>
					</div>
				</ui:repeat>
			</div>
			<div class="box-bordered p5 m5b">
				<h4>Admins:	<h:outputText styleClass="faded" value="None" rendered="#{empty manageUsersBean.project.admins}" /></h4>
				<ui:repeat var="u" value="#{manageUsersBean.project.admins}">
					<div class="box-shaded m5 p5">
						<div class="fl p5">
							<spm:userLink user="#{u}" />
						</div>
						<div class="fr">
							<tmpl:megaMenu width="100px" rendered="#{authorizationBean.isOwner}">
								<a><h:graphicImage height="25" width="25"  url="/images/stock/settings.png" style="position: relative; top: 3px;"/></a>
								<f:facet name="content">
									<h:commandLink action="#{manageUsersBean.makeOwner(u)}"
										onclick="return confirm('Really make #{u.username} an Owner? You will not be able to remove them.')">
										<div style="text-align: center;">make owner</div> 
									</h:commandLink>
									<ocp:separator />
									<h:commandLink action="#{manageUsersBean.makeMember(u)}">
										<div style="text-align: center;">make member</div> 
									</h:commandLink>
									<ocp:separator />
									<h:commandLink action="#{manageUsersBean.removeMember(u)}"
										onclick="return confirm('Really remove #{u.username} from this team?')">
										<div style="text-align: center;">remove</div> 
									</h:commandLink>
								</f:facet>
							</tmpl:megaMenu>
						</div>
						<div class="fr p5">
							Joined:
							<h:outputText styleClass="faded" value="#{manageUsersBean.project.getMembership(u).createdOn}">
								<f:convertDateTime style="SHORT" /> 
							</h:outputText><h:outputText value=" " />
						</div>
						<div class="clearing"></div>
					</div>
				</ui:repeat>
			</div>
			<div class="box-bordered p5 m5b">
				<h4>Members: <h:outputText styleClass="faded" value="None" rendered="#{empty manageUsersBean.project.members}" /></h4>
				<ui:repeat var="u" value="#{manageUsersBean.project.members}">
					<div class="box-shaded m5 p5" style="vertical-align: middle;">
						<div class="fl p5">
							<spm:userLink user="#{u}" />
						</div>
						<div class="fr">
							<tmpl:megaMenu width="100px" rendered="#{authorizationBean.isAdmin}">
								<a><h:graphicImage height="25" width="25"  url="/images/stock/settings.png" style="position: relative; top: 3px;"/></a>
								<f:facet name="content">
									<h:commandLink action="#{manageUsersBean.makeOwner(u)}" rendered="#{authorizationBean.isOwner}"
										onclick="return confirm('Really make #{u.username} an Owner? You will not be able to remove them.')">
										<div style="text-align: center;">make owner</div> 
									</h:commandLink>
									<ocp:separator rendered="#{authorizationBean.isOwner}"/>
									<h:commandLink action="#{manageUsersBean.makeAdmin(u)}" rendered="#{authorizationBean.isOwner}">
										<div style="text-align: center;">make admin</div> 
									</h:commandLink>
									<ocp:separator rendered="#{authorizationBean.isOwner}"/>
									<h:commandLink action="#{manageUsersBean.removeMember(u)}" rendered="#{authorizationBean.isAdmin}"
										onclick="return confirm('Really remove #{u.username} from this team?')">
										<div style="text-align: center;">remove</div> 
									</h:commandLink>
								</f:facet>
							</tmpl:megaMenu>
						</div>
						<div class="fr p5">
							Joined:
							<h:outputText styleClass="faded" value="#{manageUsersBean.project.getMembership(u).createdOn}">
								<f:convertDateTime style="SHORT" /> 
							</h:outputText><h:outputText value=" " />
						</div>
						<div class="clearing"></div>
					</div>
				</ui:repeat>
			</div>
		</h:form>
	</ui:define>
</ui:composition>
</html>