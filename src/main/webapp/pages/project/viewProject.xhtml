<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.prime.com.tr/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:ch="http://java.sun.com/jsf/composite/charts"
	xmlns:ocp="http://java.sun.com/jsf/composite/ocpcommon"
	xmlns:pretty="http://ocpsoft.com/prettyfaces"
	xmlns:spm="http://java.sun.com/jsf/composite/socialpm"
	xmlns:a="http://java.sun.com/jsf/composite/ajax">

<ui:composition template="/WEB-INF/view/templates/socialpm.xhtml">
	<ui:param name="title"
		value="#{currentProjectBean.project.name} &#187; #{viewProjectBean.iteration.title} (iteration)" />

	<ui:define name="content">
		
			<div class="p5 m5">
				<h:form>
					<table>
						<tr valign="top">
							<td><b>Vision:</b></td>
							<td>
								<a:editText value="#{viewProjectBean.project.vision}" rendered="#{authorizationBean.isOwner}" >
									<f:actionListener for="submit" binding="#{viewProjectBean.projectChangeListener}" />
								</a:editText>
								<h:outputText value="#{viewProjectBean.project.vision}" rendered="#{!authorizationBean.isOwner}" />
							</td>
						</tr>
						<tr valign="top">
							<td><b>Goals:</b></td>
							<td>
								<a:editText value="#{viewProjectBean.project.goals}" rendered="#{authorizationBean.isOwner}" >
									<f:actionListener for="submit" binding="#{viewProjectBean.projectChangeListener}" />
								</a:editText>
								<h:outputText value="#{viewProjectBean.project.goals}" rendered="#{!authorizationBean.isOwner}" />
							</td>
						</tr>
						<tr valign="top">
							<td><b>Objectives:</b></td>
							<td>
								<a:editText value="#{viewProjectBean.project.objectives}" rendered="#{authorizationBean.isOwner}">
									<f:actionListener for="submit" binding="#{viewProjectBean.projectChangeListener}" />
								</a:editText>
								<h:outputText value="#{viewProjectBean.project.objectives}" rendered="#{!authorizationBean.isOwner}" />
							</td>
						</tr>
					</table>
				</h:form>
			</div>
			
		<div class="box-shaded box-bordered">
		<div class="m5">

			<div>
				<h:panelGroup rendered="#{viewProjectBean.iteration.default == 'false'}">
					<div class="fr p5">
						<b> <h:panelGroup rendered="#{viewProjectBean.iteration.upcoming == 'true'}">
							<h:outputText value="Begins: " />
							<h:outputText value="#{viewProjectBean.iteration.startDate}">
								<f:converter converterId="prettyDaysConverter" />
							</h:outputText>
						</h:panelGroup> <h:panelGroup rendered="#{viewProjectBean.iteration.upcoming == 'false'}">
							<c:choose>
								<c:when test="#{viewProjectBean.iteration.inProgress == 'false'}">
									<h:outputText value="Ended: " />
									<h:outputText value="#{viewProjectBean.iteration.endDate}">
										<f:convertDateTime timeStyle="short" />
									</h:outputText>
								</c:when>
								<c:otherwise>
									<h:outputText value="Ends: " />
									<h:outputText class="faded" value="#{viewProjectBean.iteration.endDate}">
										<f:converter converterId="prettyDaysConverter" />
									</h:outputText>
								</c:otherwise>
							</c:choose>
						</h:panelGroup> </b>
					</div>
				</h:panelGroup>
				
				<h3>#{viewProjectBean.iteration.default ? '' : viewProjectBean.iteration.title }</h3>
				<div class="clearing"></div>
			</div>
			
			<h:form>
				<ocp:message type="OCPmessagesWarning" rendered="#{viewProjectBean.iteration.committed == 'false' and viewProjectBean.iteration.inProgress == 'true' and viewProjectBean.iteration.default == 'false'}">
					This iteration has not been committed. 
					<h:outputText
						value=" An admin can do this."
						rendered="#{!authorizationBean.isAdmin}" /> 
					<h:commandLink
						id="commit" value="Commit"
						action="#{viewProjectBean.commitIteration}"
						rendered="#{authorizationBean.isAdmin}" />
				</ocp:message>
	
				<ocp:message type="OCPmessagesWarning" rendered="#{viewProjectBean.project.currentIteration.default == 'true'}">
					This project does not have a current Iteration. 
					<h:outputText
						value=" An admin can fix this here: "
						rendered="#{!authorizationBean.isAdmin}" /> 
					<pretty:link mappingId="#{urlConstants.ITERATIONS}">
						<f:param value="#{viewProjectBean.project.canonicalName}" />
						Manage Iterations
					</pretty:link>?
				</ocp:message>
			</h:form>
			
			<h:panelGroup rendered="${!empty viewProjectBean.frontShelfStories and !currentIterationBean.iteration.upcoming and !currentIterationBean.iteration.default}">
				<div class="fl w50">
					<div class="box-bordered p5 m5r content"> <ch:chart name="Burndown" data="#{burndownBean.burndown}"/> </div>
				</div>
				<div class="fl w50">
					<div class="box-bordered p5 content"> <ch:chart name="Progress" data="#{burndownBean.progress}"/></div>
				</div>
			</h:panelGroup>
			
			<div class="clearing m5b"></div>
	
				<div class="content box-bordered">
					<div class="m5t m5l">
						<h4>#{viewProjectBean.iteration.default ? 'Open Stories' : 'Front burner stories' }:</h4>
					</div>
					<h:panelGroup rendered="${empty viewProjectBean.frontShelfStories}">
						<div class="OCPmessagesWarning"><b>There are no stories on
						the front shelf.</b> <br />
						<pretty:link mappingId="#{urlConstants.CREATE_STORY}">
							<f:param value="#{viewProjectBean.project.canonicalName}" />
							Add a story
						</pretty:link> , check the <pretty:link mappingId="#{urlConstants.BACK_BURNER}">
							<f:param value="#{viewProjectBean.project.canonicalName}" />
							Back-burner
						</pretty:link>, or view the <pretty:link mappingId="#{urlConstants.BACKLOG}">
							<f:param value="#{viewProjectBean.project.canonicalName}" />
							Backlog
						</pretty:link> to add stories to this Iteration.</div>
					</h:panelGroup>
					<ui:repeat id="sTable" value="${viewProjectBean.frontShelfStories}"
						var="story">
						<spm:storyBlock story="${story}" showProject="false" style="height:80px; overflow: hidden;" />
					</ui:repeat>
					<div class="clearing"></div>
				</div>
		</div>
		</div>
	</ui:define>

	<ui:define name="side-items">
		<h:panelGroup rendered="#{authorizationBean.isMember}">
			<li>
				<h3>Upcoming Milestones</h3>
				<div>
					<ui:repeat value="#{currentProjectBean.project.milestones}" var="m">
						<spm:milestone milestone="#{m}" showDescription="false" rendered="#{m.upcoming}" styleClass="m5b"/>
					</ui:repeat>
					
					 <pretty:link mappingId="#{urlConstants.MILESTONES}" styleClass="block m5t">
						<f:param value="#{currentProjectBean.exceptionSafeProject.canonicalName}" />
						<h:outputText value="&#187; Manage Milestones" />
					</pretty:link>
					<div class="clearing"></div>
				</div>
			</li>
		</h:panelGroup>
	</ui:define>
</ui:composition>
</html>