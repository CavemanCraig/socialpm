<!--

  This file is part of SocialPM: Agile Project Management Tools (SocialPM) 
 
  Copyright (c)2010 Lincoln Baxter, III <lincoln@ocpsoft.com> (OcpSoft)
  
  If you are developing and distributing open source applications under 
  the GPL Licence, then you are free to use SocialPM under the GPL 
  License:
 
  SocialPM is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
 
  SocialPM is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
 
  You should have received a copy of the GNU General Public License
  along with SocialPM.  If not, see <http://www.gnu.org/licenses/>.
   
  For OEMs, ISVs, and VARs who distribute SocialPM with their products, 
  or host SocialPM online, OcpSoft provides flexible OEM commercial 
  Licences:
  
  To purchase a License, contact OcpSoft (http://ocpsoft.com)

-->
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:a="http://java.sun.com/jsf/composite/ajax"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:pretty="http://ocpsoft.com/prettyfaces"
	xmlns:cc="http://java.sun.com/jsf/composite">

<cc:interface>
	<cc:attribute name="milestone" required="true" type="Object" />
	<cc:attribute name="style" required="false" type="String" />
	<cc:attribute name="showDescription" required="false" type="String" default="true" />
	<cc:attribute name="deletable" required="false" type="String" default="false" />
</cc:interface>

<cc:implementation>
	<h:panelGroup layout="block" class="box-bordered #{cc.attrs.styleClass}"
		style="#{cc.attrs.style}">

		<table width="100%">
			<tbody>
				<tr valign="middle">
					<td width="100px" align="center"
						style="border-right: solid 1px #ddd; padding-right: 5px;"><h:outputText
						value="#{cc.attrs.milestone.targetDate}">
						<f:convertDateTime timeStyle="short" />
					</h:outputText></td>
					<td><pretty:link mappingId="#{urlConstants.BACKLOG}" 
							styleClass="block p5 box-bordered" 
							style="color: #333; background-color: #FFFFaa;"
							title="View stories assigned to this milestone">
						<f:param value="#{currentProjectBean.project.name}" />
						<f:param name="milestone" value="${cc.attrs.milestone.name}" />
						${cc.attrs.milestone.name}
					</pretty:link></td>
					<h:panelGroup rendered="#{cc.attrs.showDescription}">
						<td width="75%" align="left"
							style="border-left: solid 1px #ddd; padding-left: 5px;"><a:editText
							value="#{cc.attrs.milestone.description}">
							<f:actionListener for="submit"
								action="#{serviceHolder.projectService.saveMilestone(currentProjectBean.project.id, cc.attrs.milestone)}" />
						</a:editText></td>
					</h:panelGroup>

					<td width="30px">
						<h:commandLink id="removeMilestone" title="remove" styleClass="m5" rendered="#{cc.attrs.deletable and authorizationBean.isMember}"
						immediate="true" onclick="return confirm('Really delete this milestone?');"	action="pretty:">
							<f:actionListener
								action="#{serviceHolder.projectService.removeMilestone(currentProjectBean.project.id, cc.attrs.milestone.id)}" />
							<h:graphicImage height="20" width="20"  url="/images/stock/trashcan_full.png" />
						</h:commandLink>
					</td>

				</tr>
			</tbody>
		</table>


	</h:panelGroup>
</cc:implementation>

</html>