<!--

  This file is part of SocialPM: Agile Project Management Tools (SocialPM) 
 
  Copyright (c)2010 Lincoln Baxter, III <lincoln@ocpsoft.com> (OcpSoft)
  
  If you are developing and distributing open source applications under 
  the GPL Licence, then you are free to use SocialPM under the GPL 
  License:
 
  SocialPM is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
 
  SocialPM is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
 
  You should have received a copy of the GNU General Public License
  along with SocialPM.  If not, see <http://www.gnu.org/licenses/>.
   
  For OEMs, ISVs, and VARs who distribute SocialPM with their products, 
  or host SocialPM online, OcpSoft provides flexible OEM commercial 
  Licences:
  
  To purchase a License, contact OcpSoft (http://ocpsoft.com)

-->
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a="http://java.sun.com/jsf/composite/ajax"
	xmlns:ocp="http://java.sun.com/jsf/composite/ocpcommon"
	xmlns:spm="http://java.sun.com/jsf/composite/socialpm"
	xmlns:pretty="http://ocpsoft.com/prettyfaces"
	xmlns:cc="http://java.sun.com/jsf/composite">

<cc:interface>
	<cc:attribute name="style" required="false" type="String" />
	<cc:attribute name="styleClass" required="false" type="String" />
	<cc:attribute name="story" required="true" type="Object" />
	<cc:attribute name="task" required="true" type="Object" />
	
	<cc:attribute name="members" required="false" type="java.util.List" />
	<cc:attribute name="disabled" required="false" type="Boolean" default="false" />
	<cc:attribute name="refreshOnSave" required="false" type="Boolean" default="true" />
	<cc:attribute name="deletable" required="false" type="Boolean" default="false" />
</cc:interface>
		

<cc:implementation>
<h:outputStylesheet name="socialpm/socialpm.css" />
<h:panelGroup id="taskBlock" layout="block" class="box-bordered p5 #{cc.attrs.styleClass} taskBlock_#{cc.attrs.task.status}" style="#{cc.attrs.style}">

	<div class="m5l" style="margin-right: 25px;" >
		<h:panelGroup rendered="#{(!cc.attrs.disabled) and (!empty cc.attrs.members) and (!cc.attrs.task.done)}">
		<a:editText value="#{cc.attrs.task.text}" >
			<f:actionListener for="submit" action="#{taskController.saveTaskAjax(cc.attrs.task)}" /> 
		</a:editText>
		</h:panelGroup>
		<h:outputText value="#{cc.attrs.task.text}" rendered="#{cc.attrs.disabled or empty cc.attrs.members or cc.attrs.task.done}"/>
	</div>
	
	<ocp:separator />
	
	<table width="100%">
		<tr>
			<td>
				<label for="hours">Hours:<ocp:message for="hours" /><br/></label>
				<h:inputText id="hours" autocomplete="off" size="1" value="#{cc.attrs.task.hoursRemain}" 
					rendered="#{!cc.attrs.disabled and cc.attrs.task.status ne 'DONE'}">
					<f:validator validatorId="integerValidator" />
				</h:inputText>
				<h:outputText class="m15l" value="#{cc.attrs.task.hoursRemain}" rendered="#{cc.attrs.disabled or cc.attrs.task.status eq 'DONE'}" />
			</td>
			<td>
				<label for="status">Status:<ocp:message for="status" /><br/></label>
				<h:selectOneMenu id="status" value="#{cc.attrs.task.status}" autocomplete="off"
					rendered="#{!cc.attrs.disabled}">
					<f:selectItems value="#{taskController.taskStatuses}"
						var="status" itemLabel="#{status.status}" itemValue="#{status}" />
				</h:selectOneMenu>
				<h:outputText class="m15l" value="#{cc.attrs.task.status.status}" rendered="#{cc.attrs.disabled}" />
			</td>
			<h:panelGroup rendered="#{!empty cc.attrs.members}">
				<td>
					<label for="assignee">Assignee:<ocp:message for="assignee" /><br/></label>
					<h:selectOneMenu id="assignee" value="#{cc.attrs.task.assignee}"
						rendered="#{!cc.attrs.disabled and cc.attrs.task.status ne 'DONE'}" autocomplete="off">
						<f:selectItem itemLabel="#{taskController.unassigned.username}" itemValue="#{taskController.unassigned.username}"  />
						<f:selectItems value="#{cc.attrs.members}" var="m" itemLabel="#{m.username}" />
						<f:converter converterId="userConverter" />
					</h:selectOneMenu>
					<h:outputText class="m15l" value="#{taskController.unassigned.username}" rendered="#{(cc.attrs.disabled or cc.attrs.task.status eq 'DONE') and cc.attrs.task.assignee == null}" />
					<spm:userLink user="#{cc.attrs.task.assignee}" rendered="#{(cc.attrs.disabled or cc.attrs.task.status eq 'DONE') and cc.attrs.task.assignee != null}" />
				</td>
			</h:panelGroup>
			<h:panelGroup rendered="${!cc.attrs.disabled and cc.attrs.story.status ne 'CLOSED'}">
				<td>
					<br/>
						<h:commandButton value="Save" action="#{taskController.saveTask(cc.attrs.task)}" />
				</td>
			</h:panelGroup> 
			<h:panelGroup rendered="${not empty cc.attrs.members and !cc.attrs.disabled and cc.attrs.task.status ne 'DONE'}">
				<td width="1%">
					<br/>
					<h:commandLink id="removeTask" title="remove" styleClass="m5t"
					rendered="#{cc.attrs.deletable}"
					immediate="true" onclick="return confirm('Really delete this task?');"
				action="#{storyController.removeTask(cc.attrs.task)}">
						<h:graphicImage height="20" width="20"  library="images" name="stock/trashcan_full.png"  />
					</h:commandLink>
				</td>
			</h:panelGroup>
		</tr>
	</table>
	
</h:panelGroup>
</cc:implementation>

</html>