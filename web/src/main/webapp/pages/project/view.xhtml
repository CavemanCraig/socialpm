<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ocp="http://java.sun.com/jsf/composite/ocpcommon"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<ui:composition template="/WEB-INF/view/templates/socialpm.xhtml">
	<ui:param name="title" value="View Project" />

	<ui:define name="header">
		<h:link value="#{projects.current.owner.username}" outcome="/pages/account" /> / #{projects.current.name}
	</ui:define>

	<ui:define name="header-right">
		<h:button value="Admin" outcome="/pages/project/admin" />
		<h:outputText value=" " />
		<h:button value="Watch" action="/pages/project/view" />
	</ui:define>

	<ui:define name="content">
	
		<div class="row">
			<div class="span8 columns">
				<div class="well" style="padding-top: 7px; padding-bottom: 10px;">
					<h:button value="Add a New Story" outcome="/pages/story/create" class="btn fr">
						<f:param name="profile" value="#{project.owner.username}" />
						<f:param name="project" value="#{project.slug}" />
					</h:button>

				
					<h:panelGroup id="status">
					<h3>Open Stories (${iteration.numOpenFrontShelfStories})</h3>
					<ul class="plain clear">
						<ui:repeat var="s" value="#{iteration.frontShelfStories}">
							<li>
								<div class="box" style="margin-bottom: 8px;">
								
									<div class="row">
										<div class="span1 columns">
											<span id="number#{s.number}" style="font-size: 20px;">#{s.number}</span><br/>
											<span id="priority#{s.number}" style="padding: 5px; padding-left: 0px; color: #bbb;">#{s.priority}</span>
										</div>
										<div class="span4 columns">
											<span style="font-size: 16px; margin-top: 10px;">
												<h:link outcome="/pages/story/view" value="As a #{s.role}, I want #{s.objective}, so that #{s.result}.">
													<f:param name="profile" value="#{project.owner.username}" />
													<f:param name="project" value="#{project.slug}" />
													<f:param name="story" value="#{s.number}" />
												 </h:link>
											</span>
										</div>
										<div class="span2 columns">
											<h:link class="fr #{s.validated ? 'ACCEPTED' : 'PENDING' }" style="padding: 5px;" outcome="/pages/story/view" value="#{s.validated ? '✓' : '✗' }" rendered="#{s.validationCount > 0}">
												<f:param name="profile" value="#{project.owner.username}" />
												<f:param name="project" value="#{project.slug}" />
												<f:param name="story" value="#{s.number}" />
											</h:link>
											<h:link class="fr #{s.progressStatus}" style="padding: 5px;" outcome="/pages/story/view" value="#{s.progressStatus.status}" rendered="#{!s.impeded}">
												<f:param name="profile" value="#{project.owner.username}" />
												<f:param name="project" value="#{project.slug}" />
												<f:param name="story" value="#{s.number}" />
											</h:link>
											<ocp:modalControl text="#{s.progressStatus.status}" for="impediments#{s.number}" styleClass="fr #{s.progressStatus}" style="padding: 5px;" rendered="#{s.impeded}"/>
										</div>
									</div>
								</div>
							</li>
						</ui:repeat>
						
						<h:panelGroup layout="block" rendered="${iteration.numFrontShelfStories == 0}" styleClass="box">
							Looks like you could use stories to work on. You can 
							<h:link outcome="/pages/story/create" value="add a new story">
								<f:param name="profile" value="#{project.owner.username}" />
								<f:param name="project" value="#{project.slug}" />
							</h:link>
							<h:panelGroup rendered="#{iteration.numBackShelfStories > 0}">, <h:outputText rendered="#{iteration.numBackShelfStories > 0}" value="or"/> move some stories to the front shelf</h:panelGroup>
							<h:panelGroup rendered="#{project.numOpenStories - iteration.numStories > 0}">, or pull some stories from the project backlog</h:panelGroup>
							 to get going.
						</h:panelGroup>
					</ul>
					</h:panelGroup>
					
					<ui:repeat var="s" value="#{iteration.frontShelfStories}">
						<ocp:modal forceId="impediments#{s.number}" title="Story #{s.number} is impeded because..." hidden="false" rendered="#{s.impeded}">
							<h:form prependId="false" id="stories">
								<p/>
									<h:panelGroup rendered="#{s.impeded}">
										<ul>
											<ui:repeat var="t" value="#{s.impededTasks}">
												<li style="margin-bottom: 10px;">
													<h:commandLink id="resolve" style="padding: 5px;" styleClass="IMPEDED" action="#{tasks.clearImpediments(t)}" value="Resolve">
														<f:ajax execute="@this @form" render="@form :status"/>
													</h:commandLink>
													#{t.text} - #{t.impediments} 
												</li>
											</ui:repeat>
										</ul>
									</h:panelGroup>
									#{s.impededTasks}
									<h:outputScript rendered="#{empty s.impededTasks}">
										$('#impediments#{s.number}').modal('hide');
									</h:outputScript>										
								</h:form>
							<f:facet name="footer">
							</f:facet>
						</ocp:modal>
					</ui:repeat>
				</div>
			</div>
			<div class="span8 columns" style="padding: 0px;">
			
				<ocp:box title="Burndown Chart" tooltip="Refresh" message="How's everything going?" outcome="/pages/project/view" padding="0">
				
					<f:param name="profile" value="#{project.owner.username}" />
					<f:param name="project" value="#{project.slug}" />
				
					<f:facet name="content">
				  		<ocp:tooltip for="refresh" title="Refresh" placement="left" trigger="hover" />
						<div class="body" style="padding: 0px; height: 345px;">
							<h:graphicImage width="458" value="#{resource['burndown.jpg']}" />
						</div>
					</f:facet>
				</ocp:box>
			
			</div>
		</div>
	
	</ui:define>

	<ui:define name="side-items">
	</ui:define>

</ui:composition>
</html>
